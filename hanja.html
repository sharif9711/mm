<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>한자 급수 타자게임 — 폭파 모드</title>
<style>
  body {
    margin: 0;
    background: white;
    color: black;
    font-family: sans-serif;
    overflow: hidden;
    text-align: center;
  }
  #gameCanvas {
    display: block;
    margin: 0 auto;
    background: white;
    border: 1px solid #ccc;
  }
  #status {
    font-size: 18px;
    margin: 6px 0;
  }
  #inputArea {
    margin-top: 6px;
  }
  #answerBox {
    font-size: 18px;
    padding: 6px;
    width: 220px;
    text-align: center;
  }
  #startBtn {
    font-size: 16px;
    padding: 6px 14px;
    margin-left: 8px;
    cursor: pointer;
  }
</style>
</head>
<body>

<div id="status">
  에너지: <span id="energy">10</span> |
  점수: <span id="score">0</span> |
  최고 점수: <span id="highscore">0</span> |
  레벨: <span id="level">1</span>
</div>

<canvas id="gameCanvas" width="600" height="600"></canvas>

<div id="inputArea">
  입력: <input type="text" id="answerBox" placeholder="한글 입력" disabled />
  <button id="startBtn">게임 시작</button>
</div>

<script>
/* =========================
   기본 설정 / 상태 변수
   ========================= */
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let ship = { x: canvas.width/2, y: canvas.height - 40, w: 50, h: 30 };
let enemies = [];
let explosions = []; // 폭발 파티클들
let energy = 10;
let score = 0;
let level = 1;
let hanjaList = []; // 한자 데이터 (아래에 직접 포함되어 있음)

let highScore = localStorage.getItem("hanjaHighScore") || 0;
document.getElementById("highscore").innerText = highScore;

let enemySpeed = 2;
let spawnInterval = 2000;
let spawnTimer;
let gameRunning = false;

/* =========================
   한자 데이터 (샘플 — 전체 371자 붙여넣기 가능)
   ========================= */
hanjaList = [  {"char":"日","sound":"일"},
  {"char":"月","sound":"월"},
  {"char":"山","sound":"산"},
  {"char":"水","sound":"수"},
  {"char":"火","sound":"화"},
  {"char":"木","sound":"목"},
  {"char":"金","sound":"금"},
  {"char":"土","sound":"토"},
  {"char":"大","sound":"대"},
  {"char":"中","sound":"중"},
  {"char":"小","sound":"소"},
  {"char":"人","sound":"인"},
  {"char":"父","sound":"부"},
  {"char":"母","sound":"모"},
  {"char":"兄","sound":"형"},
  {"char":"弟","sound":"제"},
  {"char":"心","sound":"심"},
  {"char":"手","sound":"수"},
  {"char":"足","sound":"족"},
  {"char":"目","sound":"목"},
  {"char":"耳","sound":"이"},
  {"char":"口","sound":"구"},
  {"char":"言","sound":"언"},
  {"char":"書","sound":"서"},
  {"char":"學","sound":"학"},
  {"char":"校","sound":"교"},
  {"char":"生","sound":"생"},
  {"char":"先","sound":"선"},
  {"char":"知","sound":"지"},
  {"char":"友","sound":"우"},
  {"char":"愛","sound":"애"},
  {"char":"家","sound":"가"},
  {"char":"國","sound":"국"},
  {"char":"王","sound":"왕"},
  {"char":"市","sound":"시"},
  {"char":"村","sound":"촌"},
  {"char":"道","sound":"도"},
  {"char":"寺","sound":"사"},
  {"char":"佛","sound":"불"},
  {"char":"神","sound":"신"},
  {"char":"正","sound":"정"},
  {"char":"不","sound":"불"},
  {"char":"多","sound":"다"},
  {"char":"少","sound":"소"},
  {"char":"古","sound":"고"},
  {"char":"今","sound":"금"},
  {"char":"新","sound":"신"},
  {"char":"高","sound":"고"},
  {"char":"低","sound":"저"},
  {"char":"安","sound":"안"},
  {"char":"全","sound":"전"},
  {"char":"半","sound":"반"},
  {"char":"百","sound":"백"},
  {"char":"千","sound":"천"},
  {"char":"萬","sound":"만"},
  {"char":"億","sound":"억"},
  {"char":"京","sound":"경"},
  {"char":"文","sound":"문"},
  {"char":"字","sound":"자"},
  {"char":"名","sound":"명"},
  {"char":"號","sound":"호"},
  {"char":"音","sound":"음"},
  {"char":"樂","sound":"악"},
  {"char":"曲","sound":"곡"},
  {"char":"歌","sound":"가"},
  {"char":"舞","sound":"무"},
  {"char":"美","sound":"미"},
  {"char":"武","sound":"무"},
  {"char":"力","sound":"력"},
  {"char":"男","sound":"남"},
  {"char":"女","sound":"녀"},
  {"char":"子","sound":"자"},
  {"char":"者","sound":"자"},
  {"char":"老","sound":"노"},
  {"char":"年","sound":"년"},
  {"char":"時","sound":"시"},
  {"char":"分","sound":"분"},
  {"char":"秒","sound":"초"},
  {"char":"春","sound":"춘"},
  {"char":"夏","sound":"하"},
  {"char":"秋","sound":"추"},
  {"char":"冬","sound":"동"},
  {"char":"東","sound":"동"},
  {"char":"西","sound":"서"},
  {"char":"南","sound":"남"},
  {"char":"北","sound":"북"},
  {"char":"風","sound":"풍"},
  {"char":"雨","sound":"우"},
  {"char":"雲","sound":"운"},
  {"char":"雪","sound":"설"},
  {"char":"雷","sound":"뢰"},
  {"char":"電","sound":"전"},
  {"char":"天","sound":"천"},
  {"char":"地","sound":"지"},
  {"char":"空","sound":"공"},
  {"char":"海","sound":"해"},
  {"char":"河","sound":"하"},
  {"char":"湖","sound":"호"},
  {"char":"洋","sound":"양"},
  {"char":"島","sound":"도"},
  {"char":"川","sound":"천"},
  {"char":"谷","sound":"곡"},
  {"char":"野","sound":"야"},
  {"char":"田","sound":"전"},
    {"char":"畑","sound":"밭"},
  {"char":"畵","sound":"화"},
  {"char":"畫","sound":"화"},
  {"char":"圖","sound":"도"},
  {"char":"形","sound":"형"},
  {"char":"色","sound":"색"},
  {"char":"白","sound":"백"},
  {"char":"黑","sound":"흑"},
  {"char":"赤","sound":"적"},
  {"char":"青","sound":"청"},
  {"char":"黃","sound":"황"},
  {"char":"綠","sound":"록"},
  {"char":"紫","sound":"자"},
  {"char":"光","sound":"광"},
  {"char":"明","sound":"명"},
  {"char":"暗","sound":"암"},
  {"char":"夜","sound":"야"},
  {"char":"星","sound":"성"},
  {"char":"曜","sound":"요"},
  {"char":"朝","sound":"조"},
  {"char":"晝","sound":"주"},
  {"char":"夕","sound":"석"},
  {"char":"午","sound":"오"},
  {"char":"晩","sound":"만"},
  {"char":"午","sound":"오"},
  {"char":"食","sound":"식"},
  {"char":"飯","sound":"반"},
  {"char":"飮","sound":"음"},
  {"char":"肉","sound":"육"},
  {"char":"魚","sound":"어"},
  {"char":"鳥","sound":"조"},
  {"char":"犬","sound":"견"},
  {"char":"牛","sound":"우"},
  {"char":"羊","sound":"양"},
  {"char":"馬","sound":"마"},
  {"char":"豕","sound":"시"},
  {"char":"鹿","sound":"록"},
  {"char":"米","sound":"미"},
  {"char":"豆","sound":"두"},
  {"char":"麥","sound":"맥"},
  {"char":"菜","sound":"채"},
  {"char":"果","sound":"과"},
  {"char":"茶","sound":"차"},
  {"char":"酒","sound":"주"},
  {"char":"食","sound":"식"},
  {"char":"飮","sound":"음"},
  {"char":"衣","sound":"의"},
  {"char":"服","sound":"복"},
  {"char":"帽","sound":"모"},
  {"char":"鞋","sound":"혜"},
  {"char":"衣","sound":"의"},
  {"char":"布","sound":"포"},
  {"char":"絲","sound":"사"},
  {"char":"綿","sound":"면"},
  {"char":"毛","sound":"모"},
  {"char":"皮","sound":"피"},
  {"char":"革","sound":"혁"},
  {"char":"金","sound":"금"},
  {"char":"銀","sound":"은"},
  {"char":"銅","sound":"동"},
  {"char":"鐵","sound":"철"},
  {"char":"玉","sound":"옥"},
  {"char":"石","sound":"석"},
  {"char":"珠","sound":"주"},
  {"char":"寶","sound":"보"},
  {"char":"珍","sound":"진"},
  {"char":"貝","sound":"패"},
  {"char":"貨","sound":"화"},
  {"char":"財","sound":"재"},
  {"char":"買","sound":"매"},
  {"char":"賣","sound":"매"},
  {"char":"市","sound":"시"},
  {"char":"店","sound":"점"},
  {"char":"商","sound":"상"},
  {"char":"客","sound":"객"},
  {"char":"船","sound":"선"},
  {"char":"車","sound":"차"},
  {"char":"道","sound":"도"},
  {"char":"路","sound":"로"},
  {"char":"橋","sound":"교"},
  {"char":"港","sound":"항"},
  {"char":"運","sound":"운"},
  {"char":"通","sound":"통"},
  {"char":"交","sound":"교"},
  {"char":"行","sound":"행"},
  {"char":"止","sound":"지"},
  {"char":"近","sound":"근"},
  {"char":"遠","sound":"원"},
  {"char":"速","sound":"속"},
  {"char":"遲","sound":"지"},
  {"char":"左","sound":"좌"},
  {"char":"右","sound":"우"},
  {"char":"南","sound":"남"},
  {"char":"北","sound":"북"},
  {"char":"東","sound":"동"},
  {"char":"西","sound":"서"},
  {"char":"出","sound":"출"},
  {"char":"入","sound":"입"},
  {"char":"門","sound":"문"},
  {"char":"戶","sound":"호"},
  {"char":"家","sound":"가"},
  {"char":"室","sound":"실"},
  {"char":"庭","sound":"정"},
  {"char":"堂","sound":"당"},
  {"char":"窓","sound":"창"},
    {"char":"屋","sound":"옥"},
  {"char":"室","sound":"실"},
  {"char":"床","sound":"상"},
  {"char":"席","sound":"석"},
  {"char":"廳","sound":"청"},
  {"char":"堂","sound":"당"},
  {"char":"庫","sound":"고"},
  {"char":"庫","sound":"고"},
  {"char":"學","sound":"학"},
  {"char":"校","sound":"교"},
  {"char":"室","sound":"실"},
  {"char":"園","sound":"원"},
  {"char":"場","sound":"장"},
  {"char":"所","sound":"소"},
  {"char":"院","sound":"원"},
  {"char":"病","sound":"병"},
  {"char":"醫","sound":"의"},
  {"char":"藥","sound":"약"},
  {"char":"室","sound":"실"},
  {"char":"店","sound":"점"},
  {"char":"館","sound":"관"},
  {"char":"樓","sound":"루"},
  {"char":"建","sound":"건"},
  {"char":"物","sound":"물"},
  {"char":"室","sound":"실"},
  {"char":"宅","sound":"택"},
  {"char":"村","sound":"촌"},
  {"char":"市","sound":"시"},
  {"char":"京","sound":"경"},
  {"char":"都","sound":"도"},
  {"char":"邑","sound":"읍"},
  {"char":"郡","sound":"군"},
  {"char":"道","sound":"도"},
  {"char":"國","sound":"국"},
  {"char":"界","sound":"계"},
  {"char":"世","sound":"세"},
  {"char":"界","sound":"계"},
  {"char":"地","sound":"지"},
  {"char":"球","sound":"구"},
  {"char":"全","sound":"전"},
  {"char":"世","sound":"세"},
  {"char":"洲","sound":"주"},
  {"char":"洋","sound":"양"},
  {"char":"半","sound":"반"},
  {"char":"島","sound":"도"},
  {"char":"山","sound":"산"},
  {"char":"脈","sound":"맥"},
  {"char":"江","sound":"강"},
  {"char":"河","sound":"하"},
  {"char":"湖","sound":"호"},
  {"char":"島","sound":"도"},
  {"char":"島","sound":"도"},
  {"char":"京","sound":"경"},
  {"char":"漢","sound":"한"},
  {"char":"城","sound":"성"},
  {"char":"府","sound":"부"},
  {"char":"縣","sound":"현"},
  {"char":"面","sound":"면"},
  {"char":"里","sound":"리"},
  {"char":"村","sound":"촌"},
  {"char":"洞","sound":"동"},
  {"char":"樓","sound":"루"},
  {"char":"層","sound":"층"},
  {"char":"高","sound":"고"},
  {"char":"低","sound":"저"},
  {"char":"長","sound":"장"},
  {"char":"短","sound":"단"},
  {"char":"大","sound":"대"},
  {"char":"小","sound":"소"},
  {"char":"多","sound":"다"},
  {"char":"少","sound":"소"},
  {"char":"廣","sound":"광"},
  {"char":"狹","sound":"협"},
  {"char":"厚","sound":"후"},
  {"char":"薄","sound":"박"},
  {"char":"深","sound":"심"},
  {"char":"淺","sound":"천"},
  {"char":"快","sound":"쾌"},
  {"char":"樂","sound":"락"},
  {"char":"悲","sound":"비"},
  {"char":"喜","sound":"희"},
  {"char":"怒","sound":"노"},
  {"char":"哀","sound":"애"},
  {"char":"安","sound":"안"},
  {"char":"危","sound":"위"},
  {"char":"正","sound":"정"},
  {"char":"邪","sound":"사"},
  {"char":"善","sound":"선"},
  {"char":"惡","sound":"악"},
  {"char":"美","sound":"미"},
  {"char":"醜","sound":"추"},
  {"char":"親","sound":"친"},
  {"char":"疎","sound":"소"},
  {"char":"愛","sound":"애"},
  {"char":"憎","sound":"증"},
  {"char":"信","sound":"신"},
  {"char":"疑","sound":"의"},
  {"char":"勇","sound":"용"},
  {"char":"怯","sound":"겁"},
  {"char":"勤","sound":"근"},
    {"char":"勞","sound":"로"},
  {"char":"逸","sound":"일"},
  {"char":"富","sound":"부"},
  {"char":"貧","sound":"빈"},
  {"char":"貴","sound":"귀"},
  {"char":"賤","sound":"천"},
  {"char":"善","sound":"선"},
  {"char":"惡","sound":"악"},
  {"char":"正","sound":"정"},
  {"char":"邪","sound":"사"},
  {"char":"是","sound":"시"},
  {"char":"非","sound":"비"},
  {"char":"長","sound":"장"},
  {"char":"幼","sound":"유"},
  {"char":"男","sound":"남"},
  {"char":"女","sound":"여"},
  {"char":"親","sound":"친"},
  {"char":"疎","sound":"소"},
  {"char":"和","sound":"화"},
  {"char":"戰","sound":"전"},
  {"char":"平","sound":"평"},
  {"char":"亂","sound":"란"},
  {"char":"文","sound":"문"},
  {"char":"武","sound":"무"},
  {"char":"君","sound":"군"},
  {"char":"臣","sound":"신"},
  {"char":"民","sound":"민"},
  {"char":"上","sound":"상"},
  {"char":"下","sound":"하"},
  {"char":"左","sound":"좌"},
  {"char":"右","sound":"우"},
  {"char":"前","sound":"전"},
  {"char":"後","sound":"후"},
  {"char":"內","sound":"내"},
  {"char":"外","sound":"외"},
  {"char":"入","sound":"입"},
  {"char":"出","sound":"출"},
  {"char":"始","sound":"시"},
  {"char":"終","sound":"종"},
  {"char":"開","sound":"개"},
  {"char":"閉","sound":"폐"},
  {"char":"生","sound":"생"},
  {"char":"死","sound":"사"},
  {"char":"去","sound":"거"},
  {"char":"來","sound":"래"},
  {"char":"有","sound":"유"},
  {"char":"無","sound":"무"},
  {"char":"得","sound":"득"},
  {"char":"失","sound":"실"},
  {"char":"同","sound":"동"},
  {"char":"異","sound":"이"},
  {"char":"合","sound":"합"},
  {"char":"分","sound":"분"},
  {"char":"增","sound":"증"},
  {"char":"減","sound":"감"},
  {"char":"出","sound":"출"},
  {"char":"入","sound":"입"},
  {"char":"升","sound":"승"},
  {"char":"降","sound":"강"},
  {"char":"始","sound":"시"},
  {"char":"終","sound":"종"},
  {"char":"得","sound":"득"},
  {"char":"失","sound":"실"},
  {"char":"古","sound":"고"},
  {"char":"今","sound":"금"},
  {"char":"來","sound":"래"},
  {"char":"去","sound":"거"},
  {"char":"上","sound":"상"},
  {"char":"下","sound":"하"},
  {"char":"長","sound":"장"},
  {"char":"短","sound":"단"}
];

/* =========================
   적 생성 / 제거
   ========================= */
function spawnEnemy(){
  if(!gameRunning) return;
  if(hanjaList.length === 0) return;
  const data = hanjaList[Math.floor(Math.random() * hanjaList.length)];
  enemies.push({
    x: Math.random() * (canvas.width - 80) + 40,
    y: -30 - Math.random()*40,
    char: data.char,
    sound: data.sound
  });
}

/* =========================
   폭발 이펙트 (간단한 파티클 시스템)
   ========================= */
function createExplosion(x, y, colorBase="#ff8c00", particleCount=24){
  const p = { particles: [], life: 60 };
  for(let i=0;i<particleCount;i++){
    const angle = Math.random()*Math.PI*2;
    const speed = 1 + Math.random()*4;
    const vx = Math.cos(angle)*speed;
    const vy = Math.sin(angle)*speed;
    const size = 2 + Math.random()*4;
    // 색상을 붉은-주황 계열로 약간 랜덤
    const r = 200 + Math.floor(Math.random()*55);
    const g = 80 + Math.floor(Math.random()*100);
    const b = Math.floor(Math.random()*60);
    const color = `rgba(${r},${g},${b},1)`;
    p.particles.push({ x, y, vx, vy, size, life: 40 + Math.floor(Math.random()*25), color });
  }
  // 가벼운 플래시 효과
  p.flash = { x, y, a: 0.9, life: 12 };
  explosions.push(p);
}

/* =========================
   그리기: 우주선 / 적 / 폭발
   ========================= */
function drawShip(){
  ctx.fillStyle = "#0055ff";
  ctx.beginPath();
  ctx.moveTo(ship.x, ship.y - ship.h/2);
  ctx.lineTo(ship.x - ship.w/2, ship.y + ship.h/2);
  ctx.lineTo(ship.x + ship.w/2, ship.y + ship.h/2);
  ctx.closePath();
  ctx.fill();
}

function drawEnemies(){
  ctx.fillStyle = "black";      // 한자 검정색
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.font = "36px serif";      // 서체는 serif가 한자 가독성 좋음
  for(let i = enemies.length - 1; i >= 0; i--){
    const e = enemies[i];
    ctx.fillText(e.char, e.x, e.y);
    e.y += enemySpeed;
    // 바닥 닿으면 에너지 감소
    if(e.y > canvas.height - 10){
      enemies.splice(i, 1);
      energy--;
      updateStatus();
    }
  }
}

function drawExplosions(){
  for(let i = explosions.length - 1; i >= 0; i--){
    const ex = explosions[i];
    // flash
    if(ex.flash && ex.flash.life > 0){
      ctx.save();
      ctx.globalAlpha = ex.flash.a * (ex.flash.life / 12);
      ctx.fillStyle = "rgba(255,230,150,1)";
      ctx.beginPath();
      ctx.arc(ex.flash.x, ex.flash.y, 40, 0, Math.PI*2);
      ctx.fill();
      ctx.restore();
      ex.flash.life--;
    }
    // particles
    for(let j = ex.particles.length - 1; j >= 0; j--){
      const p = ex.particles[j];
      // draw
      ctx.save();
      const alpha = Math.max(0, p.life/80);
      ctx.globalAlpha = alpha;
      ctx.fillStyle = p.color;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
      ctx.fill();
      ctx.restore();
      // update
      p.x += p.vx;
      p.y += p.vy;
      // gravity-like
      p.vy += 0.08;
      p.vx *= 0.99;
      p.vy *= 0.99;
      p.life -= 1;
      if(p.life <= 0){
        ex.particles.splice(j, 1);
      }
    }
    // reduce explosion life and remove if no particles
    ex.life--;
    if(ex.particles.length === 0 || ex.life <= 0){
      explosions.splice(i, 1);
    }
  }
}

/* =========================
   상태 업데이트 / 레벨업
   ========================= */
function updateStatus(){
  document.getElementById("energy").innerText = energy;
  document.getElementById("score").innerText = score;
  document.getElementById("level").innerText = level;

  if(score > highScore){
    highScore = score;
    localStorage.setItem("hanjaHighScore", highScore);
    document.getElementById("highscore").innerText = highScore;
  }

  if(energy <= 0){
    // 폭발 잔상 보여주고 재시작
    setTimeout(()=>{
      alert("게임 오버!\n최종 점수: " + score + "\n최고 점수: " + highScore + "\n최종 레벨: " + level);
      location.reload();
    }, 100);
  }
}

function checkLevelUp(){
  const newLevel = Math.floor(score/100) + 1;
  if(newLevel > level){
    level = newLevel;
    enemySpeed += 0.6;
    spawnInterval = Math.max(500, spawnInterval - 200);
    restartSpawn();
    // 레벨업 텍스트 잠깐 표시
    showLevelText("LEVEL " + level);
  }
}

/* =========================
   간단한 레벨 텍스트 애니 (화면 중앙에 잠깐)
   ========================= */
let levelText = { text: "", timer: 0 };
function showLevelText(txt){
  levelText.text = txt;
  levelText.timer = 60;
}

/* =========================
   스폰 재시작 / 게임 루프
   ========================= */
function restartSpawn(){
  clearInterval(spawnTimer);
  spawnTimer = setInterval(spawnEnemy, spawnInterval);
}

function gameLoop(){
  // 배경
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  // draw elements
  if(gameRunning){
    drawShip();
    drawEnemies();
    drawExplosions();
    // level text
    if(levelText.timer > 0){
      ctx.save();
      ctx.globalAlpha = levelText.timer / 60;
      ctx.fillStyle = "rgba(0,0,0,0.7)";
      ctx.font = "bold 36px Arial";
      ctx.textAlign = "center";
      ctx.fillText(levelText.text, canvas.width/2, canvas.height/2);
      ctx.restore();
      levelText.timer--;
    }
  } else {
    // 안내 텍스트 (게임 미시작 상태)
    ctx.save();
    ctx.fillStyle = "#333";
    ctx.font = "20px Arial";
    ctx.textAlign = "center";
    ctx.fillText("게임 시작 버튼을 누르면 한자가 떨어집니다.", canvas.width/2, canvas.height/2 - 20);
    ctx.fillText("아래 입력창에 한글로 입력 후 Enter", canvas.width/2, canvas.height/2 + 10);
    ctx.restore();
  }
}
setInterval(gameLoop, 30);

/* =========================
   입력(아래 input) 처리 — 정답 맞추면 폭발
   ========================= */
const answerBox = document.getElementById("answerBox");
answerBox.addEventListener("keydown", (e) => {
  if(e.key === "Enter" && gameRunning){
    const inputText = answerBox.value.trim();
    if(!inputText) return;
    // 가장 윗 적 (혹은 첫번째 적)부터 찾도록 한다 — 가까운 적 우선 등 변경 가능
    let matchedIndex = -1;
    for(let i = 0; i < enemies.length; i++){
      if(enemies[i].sound === inputText){
        matchedIndex = i;
        break;
      }
    }
    if(matchedIndex >= 0){
      const e = enemies[matchedIndex];
      // 폭발 생성 (e.x, e.y)
      createExplosion(e.x, e.y, "#ff8c00", 28);
      // 한자 제거
      enemies.splice(matchedIndex, 1);
      // 점수
      score += 20;
      checkLevelUp();
      updateStatus();
    } else {
      // 틀렸을 때 피드백 원하면 여기에 효과 추가 가능
      // (예: 화면에 빨간 테두리 깜빡임)
      flashCanvasRed();
    }
    answerBox.value = "";
  }
});

// 틀렸을 때 캔버스 깜빡임(약한 피드백)
let flashRed = 0;
function flashCanvasRed(){
  flashRed = 8;
  const orig = ctx.fillStyle;
  const id = setInterval(()=>{
    if(flashRed <= 0){
      clearInterval(id);
      return;
    }
    ctx.save();
    ctx.globalAlpha = 0.12;
    ctx.fillStyle = "red";
    ctx.fillRect(0,0,canvas.width, canvas.height);
    ctx.restore();
    flashRed--;
  }, 30);
}

/* =========================
   시작 버튼 동작
   ========================= */
document.getElementById("startBtn").addEventListener("click", () => {
  if(!gameRunning){
    gameRunning = true;
    energy = 10;
    score = 0;
    level = 1;
    enemies = [];
    explosions = [];
    enemySpeed = 2;
    spawnInterval = 2000;
    updateStatus();
    restartSpawn();
    answerBox.disabled = false;
    answerBox.focus();
  }
});

/* =========================
   유틸: 키보드로 우주선 좌우 이동 (선택사항)
   ========================= */
window.addEventListener("keydown", (e) => {
  if(!gameRunning) return;
  if(e.key === "ArrowLeft"){
    ship.x = Math.max(30, ship.x - 20);
  } else if(e.key === "ArrowRight"){
    ship.x = Math.min(canvas.width - 30, ship.x + 20);
  }
});

/* =========================
   초기 상태 표시
   ========================= */
updateStatus();
</script>
</body>
</html>
